<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_course_certificate">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="academy_lab.report_course_certificate_content"/>
            </t>
        </t>
    </template>

    <template id="report_course_certificate_content">
        <t t-call="web.external_layout">
            <div class="page">

                <style type="text/css">
                    .cert-wrap{border: 6px solid #1f2937;padding: 28px;border-radius: 10px;}
                    .cert-inner{border: 2px solid #9ca3af;padding: 22px;border-radius: 8px;}
                    .cert-title{text-align:center;font-size:34px;font-weight:700;letter-spacing:2px;margin:10px 0 6px;}
                    .cert-subtitle{text-align:center;color:#6b7280;margin:0 0 22px;font-size:14px;}
                    .cert-main{text-align:center;margin:20px 0 18px;font-size:16px;line-height:1.8;}
                    .cert-name{font-family: 'IndieFlower-Regular';font-size:26px;font-weight:700;margin:8px 0;text-decoration:underline;}
                    .cert-course{font-size:18px;font-weight:600;}
                    .cert-meta{margin-top:18px;width:100%;border-collapse:collapse;}
                    .cert-meta td{padding:8px 6px;vertical-align:top;}
                    .cert-label{color:#6b7280;font-size:12px;text-transform:uppercase;letter-spacing:1px;}
                    .cert-value{font-size:14px;font-weight:600;}
                    .cert-sign{margin-top:30px;width:100%;}
                    .cert-sign td{width:50%;text-align:center;padding-top:28px;}
                    .sign-line{border-top:1px solid #111827;margin:0 40px 6px;}
                </style>

                <div class="cert-wrap">
                    <div class="cert-inner">

                        <div class="cert-title">CERTIFICATE</div>
                        <div class="cert-subtitle">OF COMPLETION</div>

                        <div class="cert-main">
                            This certificate is proudly presented to
                            <div class="cert-name">
                                <span t-field="doc.student_id.name"/>
                            </div>
                            for successfully completing the course
                            <div class="cert-course">
                                <span t-field="doc.course_id.name"/>
                            </div>
                        </div>

                        <table class="cert-meta">
                            <tr>
                                <td>
                                    <div class="cert-label">Completion date</div>
                                    <div class="cert-value">
                                        <span t-field="doc.enrollment_date" t-options='{"widget":"date"}'/>
                                    </div>
                                </td>
                                <td>
                                    <div class="cert-label">Grade</div>
                                    <div class="cert-value"><span t-field="doc.grade"/></div>
                                </td>
                                <td>
                                    <div class="cert-label">Instructor</div>
                                    <div class="cert-value"><span t-field="doc.course_id.instructor_id.name"/></div>
                                </td>
                            </tr>
                        </table>

                        <table class="cert-sign">
                            <tr>
                                <td>
                                    <div class="sign-line"></div>
                                    <div class="cert-label">Instructor</div>
                                </td>
                                <td>
                                    <div class="sign-line"></div>
                                    <div class="cert-label">Academy Manager</div>
                                </td>
                            </tr>
                        </table>

                    </div>
                </div>

            </div>
        </t>
    </template>

<!-- #2 Course Enrollment Report -->
    <template id="report_course_enrollment">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="academy_lab.report_course_enrollment_content"/>
            </t>
        </t>
    </template>

        <template id="report_course_enrollment_content">
        <t t-call="web.external_layout">
            <div class="page">

                <style type="text/css">
                    .course-header {margin-bottom: 20px;}
                    .course-title {font-size: 24px; font-weight: 700;}
                    .course-info {font-size: 14px; color: #4b5563; margin: 5px 0;}
                    table.enrollments {width: 100%; border-collapse: collapse; margin-top: 12px;}
                    table.enrollments th, table.enrollments td {border: 1px solid #d1d5db; padding: 8px; text-align: left;}
                    table.enrollments th {background-color: #f3f4f6; font-weight: 600;}
                </style>

                <!-- Course Info -->
                <div class="course-header">
                    <div class="course-title">
                        <span t-field="doc.name"/>
                    </div>
                    <div class="course-info">
                        <strong>Course Code:</strong> <span t-field="doc.code"/>
                    </div>
                    <div class="course-info">
                        <strong>Instructor:</strong> <span t-field="doc.instructor_id.name"/>
                    </div>
                    <div class="course-info">
                        <strong>Duration (hours):</strong> <span t-field="doc.duration_hours"/>
                    </div>
                </div>

                <!-- Enrollments Table -->
                <table class="enrollments">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Enrollment Date</th>
                            <th>Grade</th>
                            <th>Attendance</th>
                            <th>Passed</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="doc.enrollment_ids" t-as="enroll">
                            <tr>
                                <td><span t-field="enroll.student_id.name"/></td>
                                <td><span t-field="enroll.enrollment_date" t-options='{"widget":"date"}'/></td>
                                <td><span t-field="enroll.grade"/></td>
                                <td><span t-field="enroll.attendance_percentage"/>%</td>
                                <td>
                                    <t t-if="enroll.passed">Yes</t>
                                    <t t-else="">No</t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </t>
    </template>


    <template id="enrollment_report_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">

                    <t t-set="data" t-value="data or {}"/>

                    <style>
                        .rpt-title { font-size: 18px; font-weight: 700; margin: 0 0 8px 0; }
                        .rpt-meta { font-size: 12px; color: #374151; margin-bottom: 12px; }
                        .rpt-meta .row { margin: 2px 0; }
                        .lbl { font-weight: 700; display: inline-block; min-width: 95px; }
                        .muted { color: #6b7280; }

                        table.rpt-table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        table.rpt-table th { background: #f3f4f6; border: 1px solid #d1d5db; padding: 6px; text-align: left; }
                        table.rpt-table td { border: 1px solid #d1d5db; padding: 6px; }
                        .badge { display: inline-block; padding: 1px 6px; border-radius: 10px; font-size: 10px; border: 1px solid #d1d5db; }
                    </style>

                    <div class="rpt-title">Enrollment Report</div>

                    <div class="rpt-meta">
                        <div class="row"><span class="lbl">Course:</span> <span class="muted"><t t-out="data.get('course_name','')"/></span></div>
                        <div class="row"><span class="lbl">Date range:</span> <span class="muted"><t t-out="data.get('date_from','')"/> → <t t-out="data.get('date_to','')"/></span></div>
                        <div class="row"><span class="lbl">Students:</span> <span class="muted"><t t-out="data.get('selected_students','All')"/></span></div>
                        <div class="row"><span class="lbl">Results:</span> <span class="muted"><t t-out="data.get('results_count', 0)"/></span></div>
                    </div>

                    <t t-if="not docs">
                        <p class="muted">No enrollments found for the selected filters.</p>
                    </t>

                    <t t-if="docs">
                        <table class="rpt-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Student</th>
                                    <th>Course</th>
                                    <th>Status</th>
                                    <th>Grade</th>
                                    <th>Attendance %</th>
                                    <th>Passed</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="docs" t-as="e">
                                    <tr>
                                        <td><t t-out="e.enrollment_date"/></td>
                                        <td><t t-out="e.student_id.name"/></td>
                                        <td><t t-out="e.course_id.name"/></td>
                                        <td><span class="badge"><t t-out="e.state"/></span></td>
                                        <td><t t-out="e.grade"/></td>
                                        <td><t t-out="e.attendance_percentage"/></td>
                                        <td>
                                            <t t-if="e.passed">Yes</t>
                                            <t t-else="">No</t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>

                </div>
            </t>
        </t>
    </template>

    
    <template id="student_transcript_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                
                <t t-foreach="students_data" t-as="student_data">
                    <div class="page">
                        
                        <style>
                            .transcript-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
                            .student-info { font-size: 13px; margin-bottom: 12px; color: #374151; }
                            .stats { margin: 15px 0; padding: 10px; background: #f9fafb; border-radius: 5px; }
                            .stats .row { margin: 4px 0; }
                            .lbl { font-weight: 700; display: inline-block; min-width: 120px; }
                            table { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 10px; }
                            th, td { border: 1px solid #d1d5db; padding: 6px; text-align: left; }
                            th { background: #f3f4f6; font-weight: 700; }
                            .section-title { font-size: 14px; font-weight: 700; margin: 15px 0 8px 0; }
                        </style>

                        <div class="transcript-title">Student Transcript</div>
                        
                        <div class="student-info">
                            <div><strong>Student:</strong> <t t-out="student_data['student'].name"/></div>
                            <div><strong>Email:</strong> <t t-out="student_data['student'].email or '—'"/></div>
                        </div>

                        <!-- Statistics -->
                        <div class="stats">
                            <div class="row"><span class="lbl">Total Courses:</span> <t t-out="student_data['total_courses']"/></div>
                            <div class="row"><span class="lbl">Average Grade:</span> <t t-out="student_data['avg_grade']"/></div>
                        </div>

                        <!-- Top 3 Courses -->
                        <div class="section-title">Top 3 Courses (by Grade)</div>
                        <t t-if="student_data['top_3']">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Course</th>
                                        <th>Grade</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="student_data['top_3']" t-as="enrollment">
                                        <tr>
                                            <td><t t-out="enrollment_index + 1"/></td>
                                            <td><t t-out="enrollment.course_id.name"/></td>
                                            <td><t t-out="enrollment.grade"/></td>
                                            <td><t t-out="enrollment.enrollment_date"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <p>No graded courses yet.</p>
                        </t>

                        <!-- All Enrollments -->
                        <div class="section-title">All Enrollments</div>
                        <t t-if="student_data['enrollments']">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Course</th>
                                        <th>Status</th>
                                        <th>Grade</th>
                                        <th>Attendance %</th>
                                        <th>Passed</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="student_data['enrollments']" t-as="e">
                                        <tr>
                                            <td><t t-out="e.enrollment_date"/></td>
                                            <td><t t-out="e.course_id.name"/></td>
                                            <td><t t-out="e.state"/></td>
                                            <td><t t-out="e.grade"/></td>
                                            <td><t t-out="e.attendance_percentage"/></td>
                                            <td><t t-if="e.passed">Yes</t><t t-else="">No</t></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <p>No enrollments found.</p>
                        </t>

                    </div>
                </t>

            </t>
        </t>
    </template>

</odoo>
